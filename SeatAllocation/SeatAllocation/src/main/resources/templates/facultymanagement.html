<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Faculty Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body, html {
            height: 100%;
            margin: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background: linear-gradient(to bottom, #87ceeb, #ffffff);
            color: #436775;
        }
        .dashboard-container {
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
        }
        .card {
            margin-bottom: 20px;
        }
        .btn-custom {
            background-color: #5e90a4;
            border: none;
            color: white;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 10px 2px;
            border-radius: 5px;
            cursor: pointer;
        }
        .btn-custom:hover {
            background-color: #87ceeb;
        }
    </style>
</head>
<body>
<div class="col-lg-6 col-md-6 col-sm-12" style="margin-left: auto;margin-right: auto;">
    <div class="text-center">
        <img style="height: 90px; width: 180px;" src="/butp.png" alt="">
        <h4>BHARATHIDASAN UNIVERSITY</h4>
    </div>
</div>
<div class="dashboard-container">
    <h4>FACULTY DASHBOARD</h4>
    <div class="card">
        <div class="card-header" style="background-color: #5e90a4; color: white;">
            View Schedule
        </div>
        <div class="card-body">
            <form id="viewScheduleForm">
                <div class="mb-3">
                    <label for="facultyId" class="form-label"><strong>Faculty ID:</strong></label>
                    <input type="text" class="form-control" id="facultyId" placeholder="Enter your ID" required>
                </div>
                <div class="mb-3">
                    <label for="viewDate" class="form-label"><strong>Date:</strong></label>
                    <input type="date" class="form-control" id="viewDate" required>
                </div>
                <button type="submit" id ="viewScheduleButton" class="btn-custom btn-block">View Schedule</button>
            </form>
            <div id="scheduleDetails" class="mt-3">
                <!-- Schedule details will be displayed here -->
            </div>
        </div>
    </div>
</div>

<script>
    document.getElementById('viewScheduleForm').addEventListener('submit', function(event) {
    event.preventDefault();

    const facultyId = document.getElementById('facultyId').value;
    const date = document.getElementById('viewDate').value;

    // Disable button and show loading state
    const viewButton = document.getElementById('viewScheduleButton');
    viewButton.disabled = true;
    viewButton.innerText = 'Loading...';

    // Construct the query string
    const queryString = new URLSearchParams({
        facultyId: facultyId,
        date: date
    }).toString();

    fetch(`/api/faculty/schedule?${queryString}`, {
        method: 'GET',
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(data => {
        console.log('Success:', data);

        const scheduleDetails = document.getElementById('scheduleDetails');
        if (data && data.length > 0) {
            // Generate table headers
            const tableHeaders = `
                <thead>
                    <tr>
                        <th>Faculty Name</th>
                        <th>Hall</th>
                        <th>Date</th>
                        <th>Session</th>
                    </tr>
                </thead>
            `;

            // Map the data into table rows
            const tableRows = data.map(item => `
                <tr>
                    <td>${item.faculty.name}</td>
                    <td>${item.hall}</td>
                    <td>${item.date}</td>
                    <td>${item.session}</td>
                </tr>
            `).join('');

            // Combine headers and rows into a full table
            scheduleDetails.innerHTML = `
                <table border="1" cellpadding="10" cellspacing="0">
                    ${tableHeaders}
                    <tbody>
                        ${tableRows}
                    </tbody>
                </table>
            `;
        } else {
            scheduleDetails.innerHTML = '<p>No schedule found for the given date and faculty ID.</p>';
        }

        // Re-enable the button after 5 seconds
        setTimeout(() => {
            viewButton.disabled = false;
            viewButton.innerText = 'View Schedule';
        }, 5000);
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Failed to fetch schedule. Please try again.');

        // Re-enable the button in case of error
        viewButton.disabled = false;
        viewButton.innerText = 'View Schedule';
    });
});



</script>
</body>
</html>
